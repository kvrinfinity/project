<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>KVR Infinity - Sales Admin Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='sales_admin.css') }}">
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 40px;
        }

        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }

        input[type="text"] {
            margin: 10px 0 20px;
            padding: 10px;
            width: 300px;
        }

        h1 {
            color: #b30000;
            margin-top: 40px;
        }
    </style>
</head>
<body>

    <h1>Sales Admin - User Details</h1>
    <input type="text" id="searchBox" placeholder="Search by Email or First Name..." onkeyup="filterTable()">

    <table id="usersTable">
        <thead style="background-color: rgb(212, 17, 17); color: white;">
            <tr>
                <th>Name</th>
                <th>Email</th>
                <th>WhatsApp</th>
                <th>Membership Valid Till</th>
                <th>Aadhar</th>
                <th>PAN</th>
                <th>Bank</th>
                <th>UPI</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users %}
            <tr>
                <td>{{ user.fname }} {{ user.lname }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.whatsapp }}</td>
                <td>{{ user.valid_till }}</td>
                <td>{{ user.adhar }}</td>
                <td>{{ user.pan }}</td>
                <td>{{ user.bank }}</td>
                <td>{{ user.upi }}</td>
                <td>{{ user.status }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h1>Withdrawal Requests</h1>
    <input type="text" id="withdrawalSearchBox" placeholder="Search by Email or Status..." onkeyup="filterWithdrawals()">

    <table id="withdrawalsTable">
        <thead style="background-color: rgb(22, 98, 209); color: white;">
            <tr>
                <th>Email</th>
                <th>Amount</th>
                <th>Status</th>
                <th>Requested At</th>
                <th>Approved At</th>
                <th>Approved By</th>
            </tr>
        </thead>
        <tbody>
            {% for wd in withdrawals %}
            <tr>
                <td>{{ wd.email }}</td>
                <td>{{ wd.amount }}</td>
                <td>{{ wd.status }}</td>
                <td>{{ wd.requested_at }}</td>
                <td>{{ wd.approved_at }}</td>
                <td>{{ wd.approved_by }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
  document.addEventListener("DOMContentLoaded", () => {
    showInitialRows("#usersTable", 5);
    showInitialRows("#withdrawalsTable", 5);
  });

  function showInitialRows(tableId, count) {
    const rows = document.querySelectorAll(`${tableId} tbody tr`);
    rows.forEach((row, index) => {
      row.style.display = index < count ? "" : "none";
    });
  }

  function filterTable() {
    const query = document.getElementById("searchBox").value.toLowerCase();
    const rows = document.querySelectorAll("#usersTable tbody tr");
    let matched = 0;

    if (query.trim() === "") {
      showInitialRows("#usersTable", 5);
      return;
    }

    rows.forEach(row => {
      const name = row.children[0].innerText.toLowerCase();
      const email = row.children[1].innerText.toLowerCase();
      if (name.includes(query) || email.includes(query)) {
        row.style.display = "";
        matched++;
      } else {
        row.style.display = "none";
      }
    });
  }

  function filterWithdrawals() {
  const query = document.getElementById("withdrawalSearchBox").value.toLowerCase();
  const rows = document.querySelectorAll("#withdrawalsTable tbody tr");

  if (query.trim() === "") {
    showInitialRows("#withdrawalsTable", 5);
    return;
  }

  rows.forEach(row => {
    const email = row.children[0].innerText.toLowerCase();
    const status = row.children[2].innerText.toLowerCase();
    if (email.includes(query) || status.includes(query)) {
      row.style.display = "";
    } else {
      row.style.display = "none";
    }
  });
}

</script>


</body>
</html>
